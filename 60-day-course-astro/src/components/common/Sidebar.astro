---
export interface Props {
  currentPhase?: number;
  currentDay?: number;
}

const { currentPhase, currentDay } = Astro.props;

// 课程结构定义
const courseStructure = [
  {
    phase: 1,
    title: '现代Web基础',
    badge: 'new',
    days: 12,
    items: [
      { day: 1, title: 'Git与版本控制基础' },
      { day: 2, title: 'HTML5语义化与可访问性' },
      { day: 3, title: '表单设计与媒体元素' },
      { day: 4, title: 'CSS3布局系统深入' },
      { day: 5, title: '响应式设计与CSS Grid' },
      { day: 6, title: 'CSS动画与过渡效果' },
      { day: 7, title: '现代CSS架构' },
      { day: 8, title: '性能优化基础' },
      { day: 9, title: '浏览器开发者工具精通' },
      { day: 10, title: 'Web标准与兼容性' },
      { day: 11, title: '项目：个人作品集网站(上)' },
      { day: 12, title: '项目：个人作品集网站(下)' },
    ]
  },
  {
    phase: 2,
    title: 'JavaScript现代编程',
    badge: 'hot',
    days: 12,
    items: [
      { day: 13, title: 'ES6+语法精通' },
      { day: 14, title: '异步编程与Promise' },
      { day: 15, title: 'DOM操作与事件系统' },
      { day: 16, title: '函数式编程基础' },
      { day: 17, title: '面向对象编程' },
      { day: 18, title: '模块化与构建工具' },
      { day: 19, title: 'TypeScript入门' },
      { day: 20, title: '浏览器API深入' },
      { day: 21, title: '数据结构与算法' },
      { day: 22, title: '设计模式实践' },
      { day: 23, title: '项目：任务管理应用(上)' },
      { day: 24, title: '项目：任务管理应用(下)' },
    ]
  },
  {
    phase: 3,
    title: 'React现代开发',
    badge: 'pro',
    days: 16,
    items: [
      { day: 25, title: 'React核心概念' },
      { day: 26, title: '组件设计与Props' },
      { day: 27, title: 'State与生命周期' },
      { day: 28, title: 'Hooks深入理解' },
      { day: 29, title: 'Context与状态管理' },
      { day: 30, title: 'React Router路由' },
      { day: 31, title: '表单处理与验证' },
      { day: 32, title: '性能优化技巧' },
      { day: 33, title: '测试驱动开发' },
      { day: 34, title: 'Redux状态管理' },
      { day: 35, title: 'API集成与数据获取' },
      { day: 36, title: '认证与授权' },
      { day: 37, title: '高级组件模式' },
      { day: 38, title: '项目：电商前端(一)' },
      { day: 39, title: '项目：电商前端(二)' },
      { day: 40, title: '项目：电商前端(三)' },
    ]
  },
  {
    phase: 4,
    title: '后端开发与数据库',
    days: 12,
    items: [
      { day: 41, title: 'Node.js基础' },
      { day: 42, title: 'Express框架入门' },
      { day: 43, title: 'RESTful API设计' },
      { day: 44, title: '数据库基础与SQL' },
      { day: 45, title: 'MongoDB与Mongoose' },
      { day: 46, title: '用户认证与JWT' },
      { day: 47, title: '文件上传与处理' },
      { day: 48, title: 'WebSocket实时通信' },
      { day: 49, title: '缓存与性能优化' },
      { day: 50, title: '错误处理与日志' },
      { day: 51, title: '项目：博客API(上)' },
      { day: 52, title: '项目：博客API(下)' },
    ]
  },
  {
    phase: 5,
    title: '全栈开发与部署',
    days: 8,
    items: [
      { day: 53, title: 'Docker容器化' },
      { day: 54, title: 'CI/CD流程' },
      { day: 55, title: '云服务与部署' },
      { day: 56, title: '监控与日志管理' },
      { day: 57, title: '安全最佳实践' },
      { day: 58, title: '性能监控与优化' },
      { day: 59, title: '项目：社交媒体应用(上)' },
      { day: 60, title: '项目：社交媒体应用(下)' },
    ]
  }
];

// 计算总进度
const totalDays = 60;
const completedDays = currentDay || 0;
const progressPercentage = Math.round((completedDays / totalDays) * 100);
---

<div class="p-4">
  <!-- 进度概览 -->
  <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
      学习进度
    </h3>
    <div class="progress-bar mb-2">
      <div 
        class="progress-bar-fill" 
        style={`width: ${progressPercentage}%`}
      ></div>
    </div>
    <p class="text-xs text-gray-600 dark:text-gray-400">
      已完成 {completedDays}/{totalDays} 天 ({progressPercentage}%)
    </p>
  </div>
  
  <!-- 课程导航 -->
  <div class="space-y-4">
    {courseStructure.map((phase) => (
      <div key={phase.phase} class="border-b border-gray-200 dark:border-gray-700 pb-4">
        <div class="flex items-center justify-between mb-2">
          <h4 class="font-semibold text-gray-900 dark:text-white">
            第{phase.phase}阶段：{phase.title}
          </h4>
          {phase.badge && (
            <span class={`badge badge-${phase.badge}`}>
              {phase.badge === 'new' ? '基础' : phase.badge === 'hot' ? '核心' : '进阶'}
            </span>
          )}
        </div>
        
        <ul class="space-y-1">
          {phase.items.map((item) => {
            const isActive = currentPhase === phase.phase && currentDay === item.day;
            const isCompleted = currentDay ? item.day < currentDay : false;
            
            return (
              <li key={item.day}>
                <a
                  href={`/course/phase-${phase.phase}/day-${item.day}`}
                  class={`block px-3 py-2 text-sm rounded-md transition-colors duration-200 ${
                    isActive
                      ? 'bg-primary text-white font-medium'
                      : isCompleted
                      ? 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'
                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                  }`}
                >
                  <span class="flex items-center">
                    {isCompleted && (
                      <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                      </svg>
                    )}
                    Day {item.day}: {item.title}
                  </span>
                </a>
              </li>
            );
          })}
        </ul>
      </div>
    ))}
  </div>
  
  <!-- 快速链接 -->
  <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
      快速链接
    </h4>
    <ul class="space-y-2">
      <li>
        <a href="/projects" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary">
          📁 综合项目
        </a>
      </li>
      <li>
        <a href="/resources" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary">
          📚 学习资源
        </a>
      </li>
      <li>
        <a href="/community" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary">
          💬 社区讨论
        </a>
      </li>
    </ul>
  </div>
</div>