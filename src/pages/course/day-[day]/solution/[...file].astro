---
/**
 * æ–‡ä»¶æŸ¥çœ‹é¡µé¢
 * ç”¨äºå±•ç¤ºè§£å†³æ–¹æ¡ˆä¸­çš„å®Œæ•´ä»£ç æ–‡ä»¶
 */
import { getCollection } from 'astro:content'
import CodeDisplay from '@components/CodeDisplay.astro'
import '@styles/global.css'

export async function getStaticPaths() {
  const solutions = await getCollection('solutions')
  const courses = await getCollection('courses')
  const phases = await getCollection('phases')
  
  const paths = []
  
  // ä¸ºæ¯ä¸ªè§£å†³æ–¹æ¡ˆçš„æ¯ä¸ªæ–‡ä»¶åˆ›å»ºè·¯å¾„
  solutions.forEach((solution) => {
    const course = courses.find(c => c.data.day === solution.data.day)
    const phase = phases.find(p => p.id.includes(course?.data.phase))
    
    solution.data.files.forEach((file) => {
      paths.push({
        params: { 
          day: solution.data.day.toString(),
          file: file.path
        },
        props: { 
          solution, 
          course, 
          phase,
          file,
          dayNumber: solution.data.day
        }
      })
    })
  })
  
  return paths
}

const { day, file: filePath } = Astro.params
const { solution, course, phase, file, dayNumber } = Astro.props

const pageTitle = `${file.path} - Day ${dayNumber} è§£å†³æ–¹æ¡ˆ | 60å¤©Webå¼€å‘è¯¾ç¨‹`
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{pageTitle}</title>
  <meta name="description" content={`æŸ¥çœ‹Day ${dayNumber}è§£å†³æ–¹æ¡ˆä¸­çš„${file.path}æ–‡ä»¶`}>
</head>
<body>
  <div class="file-viewer-container">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="breadcrumb" aria-label="é¢åŒ…å±‘å¯¼èˆª">
      <ol>
        <li><a href="/">é¦–é¡µ</a></li>
        <li><a href="/course">è¯¾ç¨‹</a></li>
        <li><a href={`/course/phase-${phase.data.number}`}>{phase.data.name}</a></li>
        <li><a href={`/course/day-${day}`}>Day {day}</a></li>
        <li><a href={`/course/day-${day}/exercise`}>ç»ƒä¹ </a></li>
        <li><a href={`/course/day-${day}/solution`}>è§£å†³æ–¹æ¡ˆ</a></li>
        <li aria-current="page">{file.path}</li>
      </ol>
    </nav>

    <!-- æ–‡ä»¶æŸ¥çœ‹å™¨å¤´éƒ¨ -->
    <header class="file-viewer-header">
      <h1 class="file-viewer-title">
        <span class="file-icon">ğŸ“„</span>
        {file.path}
      </h1>
      {file.description && (
        <p class="file-description">{file.description}</p>
      )}
    </header>

    <!-- ä»£ç å±•ç¤º -->
    <div class="file-content">
      <div class="file-notice">
        <p>âš ï¸ æ³¨æ„ï¼šæ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ã€‚å®Œæ•´çš„ä»£ç æ–‡ä»¶å°†åœ¨å†…å®¹è¿ç§»å®Œæˆåæ˜¾ç¤ºã€‚</p>
        <p>å½“å‰è¿™æ˜¯ä¸€ä¸ªå ä½é¡µé¢ï¼Œç”¨äºå±•ç¤ºæ–‡ä»¶æŸ¥çœ‹åŠŸèƒ½çš„ç•Œé¢è®¾è®¡ã€‚</p>
      </div>
      
      <!-- å®é™…ä½¿ç”¨æ—¶åº”è¯¥æ˜¾ç¤ºçœŸå®çš„ä»£ç å†…å®¹ -->
      <CodeDisplay 
        code={`// ${file.path}\n// è¿™é‡Œå°†æ˜¾ç¤ºå®Œæ•´çš„ä»£ç æ–‡ä»¶å†…å®¹\n\n// ç¤ºä¾‹ä»£ç ï¼š\nfunction example() {\n  console.log('Hello, World!');\n}\n\nexport default example;`}
        language={file.language}
        filename={file.path}
        description={file.description}
        maxLines={50}
      />
    </div>

    <!-- æ–‡ä»¶æ“ä½œ -->
    <div class="file-actions">
      <button class="btn btn-primary download-btn">
        â¬‡ï¸ ä¸‹è½½æ–‡ä»¶
      </button>
      <button class="btn btn-secondary raw-btn">
        ğŸ“‹ æŸ¥çœ‹åŸå§‹å†…å®¹
      </button>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <nav class="file-navigation">
      <a href={`/course/day-${day}/solution`} class="nav-back">
        â† è¿”å›è§£å†³æ–¹æ¡ˆ
      </a>
    </nav>
  </div>

  <style>
    /* æ–‡ä»¶æŸ¥çœ‹å™¨æ ·å¼ */
    .file-viewer-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-8) var(--space-6);
      min-height: 100vh;
    }

    .file-viewer-header {
      margin-bottom: var(--space-8);
      padding-bottom: var(--space-6);
      border-bottom: 2px solid var(--border-color);
    }

    .file-viewer-title {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--text-primary);
      font-family: var(--font-mono);
      margin-bottom: var(--space-3);
    }

    .file-icon {
      font-size: var(--text-4xl);
    }

    .file-description {
      font-size: var(--text-lg);
      color: var(--text-secondary);
      margin-top: var(--space-3);
    }

    .file-content {
      margin-bottom: var(--space-8);
    }

    .file-notice {
      background-color: var(--color-warning);
      color: white;
      padding: var(--space-6);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-6);
    }

    .file-notice p {
      margin: 0;
      margin-bottom: var(--space-2);
    }

    .file-notice p:last-child {
      margin-bottom: 0;
    }

    .file-actions {
      display: flex;
      gap: var(--space-4);
      margin-bottom: var(--space-8);
      padding: var(--space-6);
      background-color: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-color);
    }

    .download-btn,
    .raw-btn {
      padding: var(--space-3) var(--space-6);
    }

    .file-navigation {
      padding-top: var(--space-8);
      border-top: 1px solid var(--border-color);
    }

    .nav-back {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--text-secondary);
      font-weight: 500;
      padding: var(--space-3) var(--space-4);
      background-color: var(--bg-secondary);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .nav-back:hover {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      text-decoration: none;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .file-viewer-container {
        padding: var(--space-6) var(--space-4);
      }

      .file-viewer-title {
        font-size: var(--text-2xl);
      }

      .file-actions {
        flex-direction: column;
        padding: var(--space-4);
      }

      .download-btn,
      .raw-btn {
        width: 100%;
      }
    }
  </style>

  <script>
    // ä¸‹è½½åŠŸèƒ½ï¼ˆå ä½ï¼‰
    document.querySelector('.download-btn')?.addEventListener('click', () => {
      alert('ä¸‹è½½åŠŸèƒ½å³å°†æ¨å‡ºï¼å½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ã€‚')
    })
    
    // æŸ¥çœ‹åŸå§‹å†…å®¹ï¼ˆå ä½ï¼‰
    document.querySelector('.raw-btn')?.addEventListener('click', () => {
      alert('åŸå§‹å†…å®¹æŸ¥çœ‹åŠŸèƒ½å³å°†æ¨å‡ºï¼')
    })
  </script>
</body>
</html>