---
/**
 * è¯¾ç¨‹æ€»è§ˆé¡µé¢
 * å±•ç¤ºæ‰€æœ‰è¯¾ç¨‹é˜¶æ®µå’Œå­¦ä¹ è¿›åº¦
 */
import { getCollection } from 'astro:content'
import type { PhaseInfo } from '../../types'
import '../../styles/global.css'

// è·å–æ‰€æœ‰é˜¶æ®µå’Œè¯¾ç¨‹æ•°æ®
const phases = await getCollection('phases')
const courses = await getCollection('courses')

// æŒ‰é˜¶æ®µç»„ç»‡è¯¾ç¨‹
const phaseData = phases.map(phase => {
  const phaseCourses = courses
    .filter(course => course.data.phase === phase.id)
    .sort((a, b) => a.data.day - b.data.day)
  
  return {
    phase: phase.data,
    phaseId: phase.id,
    courses: phaseCourses,
    totalDays: phaseCourses.length
  }
}).sort((a, b) => a.phase.number - b.phase.number)

const totalDays = courses.length
const pageTitle = 'è¯¾ç¨‹æ€»è§ˆ | 40å¤©Webå¼€å‘è¯¾ç¨‹'
const pageDescription = 'ä»é›¶åŸºç¡€åˆ°Reactå…¨æ ˆå¼€å‘ï¼Œ40å¤©ç³»ç»Ÿå­¦ä¹ Webå¼€å‘çš„å®Œæ•´è·¯å¾„'
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{pageTitle}</title>
  <meta name="description" content={pageDescription}>
</head>
<body>
  <div class="overview-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <header class="overview-header">
      <h1 class="overview-title">40å¤©Webå¼€å‘è¯¾ç¨‹</h1>
      <p class="overview-subtitle">ä»é›¶åŸºç¡€åˆ°å…¨æ ˆå¼€å‘çš„ç³»ç»Ÿå­¦ä¹ è·¯å¾„</p>
      
      <!-- å­¦ä¹ è¿›åº¦æ¦‚è§ˆ -->
      <div class="progress-overview">
        <div class="progress-stats">
          <div class="stat-item">
            <span class="stat-number" id="completed-days">0</span>
            <span class="stat-label">å·²å®Œæˆ</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{totalDays}</span>
            <span class="stat-label">æ€»å¤©æ•°</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="progress-percentage">0%</span>
            <span class="stat-label">å®Œæˆåº¦</span>
          </div>
        </div>
        
        <div class="overall-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="overall-progress-fill" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="progress-actions">
          <a href="/course/progress" class="btn btn-primary">
            æŸ¥çœ‹è¯¦ç»†è¿›åº¦
          </a>
        </div>
      </div>
    </header>

    <!-- å­¦ä¹ è·¯å¾„ä»‹ç» -->
    <section class="learning-path">
      <h2>ğŸ¯ å­¦ä¹ è·¯å¾„</h2>
      <div class="path-intro">
        <p>æœ¬è¯¾ç¨‹åˆ†ä¸º5ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„å­¦ä¹ ç›®æ ‡å’Œå®è·µé¡¹ç›®ï¼š</p>
        <ol class="path-list">
          <li><strong>ç°ä»£WebåŸºç¡€</strong>ï¼šæŒæ¡å¼€å‘ç¯å¢ƒã€HTML5ã€CSS3å’ŒTailwind</li>
          <li><strong>JavaScriptç²¾é€š</strong>ï¼šæ·±å…¥å­¦ä¹ ç°ä»£JavaScriptå’ŒTypeScript</li>
          <li><strong>Reactå¼€å‘</strong>ï¼šæ„å»ºäº¤äº’å¼å•é¡µåº”ç”¨</li>
          <li><strong>åç«¯å¼€å‘</strong>ï¼šNode.jsæœåŠ¡ç«¯å¼€å‘å’Œæ•°æ®åº“</li>
          <li><strong>å…¨æ ˆéƒ¨ç½²</strong>ï¼šé¡¹ç›®éƒ¨ç½²å’ŒDevOpså®è·µ</li>
        </ol>
      </div>
    </section>

    <!-- è¯¾ç¨‹é˜¶æ®µå¡ç‰‡ -->
    <section class="phases-section">
      <h2>ğŸ“š è¯¾ç¨‹å†…å®¹</h2>
      <div class="phases-grid">
        {phaseData.map(({ phase, phaseId, courses, totalDays }) => (
          <div class="phase-card" data-phase={phaseId}>
            <div class="phase-header">
              <span class="phase-icon">{phase.icon}</span>
              <h3 class="phase-title">
                é˜¶æ®µ {phase.number}: {phase.name}
              </h3>
            </div>
            
            <p class="phase-description">{phase.description}</p>
            
            <div class="phase-meta">
              <span class="phase-days">Day {phase.startDay} - Day {phase.endDay}</span>
              <span class="phase-duration">{totalDays} å¤©</span>
            </div>
            
            <div class="phase-progress">
              <div class="progress-bar">
                <div 
                  class="progress-fill phase-progress-fill" 
                  data-phase={phaseId}
                  style="width: 0%"
                ></div>
              </div>
              <span class="phase-progress-text" data-phase={phaseId}>0/{totalDays} å®Œæˆ</span>
            </div>
            
            <details class="phase-details">
              <summary>æŸ¥çœ‹è¯¾ç¨‹åˆ—è¡¨</summary>
              <ul class="course-list">
                {courses.map(course => (
                  <li class="course-item" data-day={course.data.day}>
                    <a href={`/course/day-${course.data.day}`}>
                      <span class="day-badge">Day {course.data.day}</span>
                      <span class="course-name">{course.data.title}</span>
                      <span class="completion-check" data-day={course.data.day}>â­•</span>
                    </a>
                  </li>
                ))}
              </ul>
            </details>
            
            <a href={`/course/day-${phase.startDay}`} class="btn btn-primary phase-start">
              å¼€å§‹å­¦ä¹ 
            </a>
          </div>
        ))}
      </div>
    </section>

    <!-- å­¦ä¹ å»ºè®® -->
    <section class="study-tips">
      <h2>ğŸ’¡ å­¦ä¹ å»ºè®®</h2>
      <div class="tips-grid">
        <div class="tip-card">
          <h3>ğŸ“… åˆ¶å®šè®¡åˆ’</h3>
          <p>æ¯å¤©å®‰æ’1-2å°æ—¶å­¦ä¹ æ—¶é—´ï¼Œä¿æŒç¨³å®šçš„å­¦ä¹ èŠ‚å¥ã€‚å‘¨æœ«å¯ä»¥ç”¨æ¥å¤ä¹ å’Œå®Œæˆé¡¹ç›®ã€‚</p>
        </div>
        <div class="tip-card">
          <h3>âœï¸ åŠ¨æ‰‹å®è·µ</h3>
          <p>ä¸è¦åªçœ‹ä¸ç»ƒï¼Œæ¯ä¸ªç¤ºä¾‹éƒ½è¦äº²è‡ªæ•²ä¸€éä»£ç ã€‚é‡åˆ°é—®é¢˜å…ˆå°è¯•è‡ªå·±è§£å†³ã€‚</p>
        </div>
        <div class="tip-card">
          <h3>ğŸ“ åšå¥½ç¬”è®°</h3>
          <p>è®°å½•é‡è¦æ¦‚å¿µå’Œå¸¸è§é”™è¯¯ï¼Œå»ºç«‹è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚å®šæœŸå›é¡¾å·©å›ºæ‰€å­¦å†…å®¹ã€‚</p>
        </div>
        <div class="tip-card">
          <h3>ğŸ¤ äº¤æµåˆ†äº«</h3>
          <p>åŠ å…¥å­¦ä¹ ç¤¾åŒºï¼Œä¸å…¶ä»–å­¦ä¹ è€…äº¤æµç»éªŒã€‚åˆ†äº«ä½ çš„å­¦ä¹ æˆæœå’Œé‡åˆ°çš„é—®é¢˜ã€‚</p>
        </div>
      </div>
    </section>

    <!-- å¿«é€Ÿå¯¼èˆª -->
    <section class="quick-nav">
      <h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
      <div class="nav-buttons">
        <a href="/course/day-1" class="btn btn-primary btn-large">
          ä»ç¬¬ä¸€å¤©å¼€å§‹
        </a>
        <button class="btn btn-secondary btn-large" id="continue-learning">
          ç»§ç»­ä¸Šæ¬¡å­¦ä¹ 
        </button>
        <button class="btn btn-secondary btn-large" id="reset-progress">
          é‡ç½®è¿›åº¦
        </button>
      </div>
    </section>
  </div>

  <script define:vars={{ totalDays, phaseDataForScript: phaseData.map(p => ({
    phaseId: p.phaseId,
    startDay: p.phase.startDay,
    endDay: p.phase.endDay,
    totalDays: p.totalDays
  })) }}>
    // è·å–å·²å®Œæˆçš„è¯¾ç¨‹
    const completedDays = JSON.parse(localStorage.getItem('completedDays') || '[]')
    
    // æ›´æ–°æ•´ä½“è¿›åº¦
    function updateOverallProgress() {
      const completedCount = completedDays.length
      const percentage = Math.round((completedCount / totalDays) * 100)
      
      document.getElementById('completed-days')!.textContent = completedCount.toString()
      document.getElementById('progress-percentage')!.textContent = `${percentage}%`
      
      const progressFill = document.getElementById('overall-progress-fill') as HTMLElement
      progressFill.style.width = `${percentage}%`
    }
    
    // æ›´æ–°é˜¶æ®µè¿›åº¦
    function updatePhaseProgress() {
      const phaseData = phaseDataForScript
      
      phaseData.forEach(phase => {
        const phaseCompleted = completedDays.filter((day: string) => {
          const dayNum = parseInt(day)
          return dayNum >= phase.startDay && dayNum <= phase.endDay
        }).length
        
        const percentage = Math.round((phaseCompleted / phase.totalDays) * 100)
        
        const progressFill = document.querySelector(`.phase-progress-fill[data-phase="${phase.phaseId}"]`) as HTMLElement
        const progressText = document.querySelector(`.phase-progress-text[data-phase="${phase.phaseId}"]`) as HTMLElement
        
        if (progressFill) progressFill.style.width = `${percentage}%`
        if (progressText) progressText.textContent = `${phaseCompleted}/${phase.totalDays} å®Œæˆ`
      })
    }
    
    // æ›´æ–°è¯¾ç¨‹åˆ—è¡¨çš„å®ŒæˆçŠ¶æ€
    function updateCourseList() {
      completedDays.forEach((day: string) => {
        const checkmark = document.querySelector(`.completion-check[data-day="${day}"]`)
        if (checkmark) {
          checkmark.textContent = 'âœ…'
        }
        
        const courseItem = document.querySelector(`.course-item[data-day="${day}"]`)
        if (courseItem) {
          courseItem.classList.add('completed')
        }
      })
    }
    
    // ç»§ç»­å­¦ä¹ æŒ‰é’®
    document.getElementById('continue-learning')?.addEventListener('click', () => {
      if (completedDays.length === 0) {
        window.location.href = '/course/day-1'
      } else {
        const lastCompleted = Math.max(...completedDays.map((d: string) => parseInt(d)))
        const nextDay = lastCompleted < totalDays ? lastCompleted + 1 : lastCompleted
        window.location.href = `/course/day-${nextDay}`
      }
    })
    
    // é‡ç½®è¿›åº¦
    document.getElementById('reset-progress')?.addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ è¿›åº¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
        localStorage.removeItem('completedDays')
        localStorage.removeItem('exerciseProgress')
        localStorage.removeItem('solutionFeedback')
        location.reload()
      }
    })
    
    // åˆå§‹åŒ–é¡µé¢
    updateOverallProgress()
    updatePhaseProgress()
    updateCourseList()
  </script>

  <style>
    /* æ€»è§ˆé¡µé¢ç‰¹å®šæ ·å¼ */
    .overview-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-8) var(--space-4);
    }

    .overview-header {
      text-align: center;
      margin-bottom: var(--space-12);
    }

    .overview-title {
      font-size: var(--text-5xl);
      margin-bottom: var(--space-3);
    }

    .overview-subtitle {
      font-size: var(--text-xl);
      color: var(--text-secondary);
      margin-bottom: var(--space-8);
    }

    .progress-overview {
      max-width: 600px;
      margin: 0 auto;
    }

    .progress-stats {
      display: flex;
      justify-content: space-around;
      margin-bottom: var(--space-4);
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      display: block;
      font-size: var(--text-3xl);
      font-weight: 700;
      color: var(--color-primary);
    }

    .stat-label {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .overall-progress {
      background-color: var(--bg-secondary);
      padding: var(--space-4);
      border-radius: var(--radius-lg);
    }

    .learning-path {
      margin-bottom: var(--space-12);
    }

    .path-intro {
      background-color: var(--bg-secondary);
      padding: var(--space-6);
      border-radius: var(--radius-lg);
    }

    .path-list {
      margin-top: var(--space-4);
      margin-left: var(--space-6);
    }

    .path-list li {
      margin-bottom: var(--space-2);
    }

    .phases-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: var(--space-6);
      margin-top: var(--space-6);
    }

    .phase-card {
      background-color: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      transition: box-shadow var(--transition-fast);
    }

    .phase-card:hover {
      box-shadow: var(--shadow-lg);
    }

    .phase-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-4);
    }

    .phase-icon {
      font-size: var(--text-3xl);
    }

    .phase-title {
      margin: 0;
      font-size: var(--text-xl);
    }

    .phase-description {
      color: var(--text-secondary);
      margin-bottom: var(--space-4);
    }

    .phase-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-4);
      color: var(--text-tertiary);
      font-size: var(--text-sm);
    }

    .phase-progress {
      margin-bottom: var(--space-4);
    }

    .phase-progress-text {
      display: block;
      text-align: right;
      margin-top: var(--space-2);
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .phase-details {
      margin-bottom: var(--space-4);
    }

    .phase-details summary {
      cursor: pointer;
      color: var(--color-primary);
      font-weight: 500;
      padding: var(--space-2) 0;
    }

    .course-list {
      list-style: none;
      margin-top: var(--space-3);
    }

    .course-item {
      margin-bottom: var(--space-2);
    }

    .course-item a {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-2);
      border-radius: var(--radius-md);
      transition: background-color var(--transition-fast);
    }

    .course-item a:hover {
      background-color: var(--bg-secondary);
      text-decoration: none;
    }

    .course-item.completed a {
      color: var(--text-tertiary);
    }

    .day-badge {
      background-color: var(--bg-tertiary);
      padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 500;
      min-width: 50px;
      text-align: center;
    }

    .course-name {
      flex: 1;
      color: var(--text-primary);
    }

    .completion-check {
      font-size: var(--text-sm);
    }

    .phase-start {
      width: 100%;
    }

    .study-tips {
      margin-bottom: var(--space-12);
    }

    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-6);
      margin-top: var(--space-6);
    }

    .tip-card {
      background-color: var(--bg-secondary);
      padding: var(--space-6);
      border-radius: var(--radius-lg);
    }

    .tip-card h3 {
      margin-bottom: var(--space-3);
    }

    .tip-card p {
      margin: 0;
      color: var(--text-secondary);
    }

    .quick-nav {
      text-align: center;
    }

    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: var(--space-4);
      margin-top: var(--space-6);
      flex-wrap: wrap;
    }

    .btn-large {
      padding: var(--space-4) var(--space-8);
      font-size: var(--text-lg);
    }

    @media (max-width: 768px) {
      .overview-title {
        font-size: var(--text-3xl);
      }

      .phases-grid {
        grid-template-columns: 1fr;
      }

      .tips-grid {
        grid-template-columns: 1fr;
      }

      .nav-buttons {
        flex-direction: column;
      }

      .btn-large {
        width: 100%;
      }
    }

    /* Progress Actions */
    .progress-actions {
      margin-top: 1.5rem;
      text-align: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--color-primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(66, 184, 131, 0.3);
    }
  </style>
</body>
</html>