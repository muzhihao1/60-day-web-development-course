---
import BaseLayout from '@layouts/BaseLayout.astro';
import { phases } from '@lib/navigation';

// Get the day number from the URL
const { day } = Astro.params;
const dayNumber = parseInt(day);

// Validate day number
if (!day || isNaN(dayNumber) || dayNumber < 1 || dayNumber > 60) {
  return Astro.redirect('/404');
}

// Find which phase this day belongs to
const currentPhase = phases.find(phase => phase.days.includes(dayNumber));
if (!currentPhase) {
  return Astro.redirect('/404');
}

// Define static paths for all 60 days
export function getStaticPaths() {
  return Array.from({ length: 60 }, (_, i) => ({
    params: { day: String(i + 1) }
  }));
}

// Mock content for demonstration - In production, this would come from MDX files or a CMS
const dayContent = {
  1: {
    title: 'Gitä¸ç‰ˆæœ¬æ§åˆ¶åŸºç¡€',
    description: 'å­¦ä¹ Gitçš„åŸºæœ¬æ¦‚å¿µå’Œå‘½ä»¤ï¼ŒæŒæ¡ç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒæŠ€èƒ½',
    objectives: [
      'ç†è§£ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µå’Œé‡è¦æ€§',
      'æŒæ¡Gitçš„åŸºæœ¬å‘½ä»¤',
      'å­¦ä¼šä½¿ç”¨GitHubè¿›è¡Œä»£ç æ‰˜ç®¡',
      'äº†è§£å›¢é˜Ÿåä½œçš„åŸºæœ¬æµç¨‹'
    ],
    overview: 'Gitæ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­æœ€é‡è¦çš„å·¥å…·ä¹‹ä¸€ã€‚ä»Šå¤©æˆ‘ä»¬å°†å­¦ä¹ Gitçš„åŸºç¡€çŸ¥è¯†ï¼Œç†è§£ç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶å®é™…æ“ä½œGitçš„å¸¸ç”¨å‘½ä»¤ã€‚',
    sections: [
      {
        title: 'æ ¸å¿ƒæ¦‚å¿µ',
        subsections: [
          {
            title: 'ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æ§åˆ¶ï¼Ÿ',
            content: 'ç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§è®°å½•æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢æƒ…å†µçš„ç³»ç»Ÿã€‚å®ƒè®©ä½ èƒ½å¤Ÿï¼š',
            list: [
              'è¿½è¸ªä»£ç çš„å†å²å˜æ›´',
              'å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬',
              'å¤šäººåä½œå¼€å‘',
              'ç®¡ç†ä¸åŒçš„åŠŸèƒ½åˆ†æ”¯'
            ]
          }
        ]
      },
      {
        title: 'è¯¦ç»†è®²è§£',
        subsections: [
          {
            title: 'Gitçš„å·¥ä½œåŸç†',
            content: 'Gitä½¿ç”¨ä¸‰ä¸ªä¸»è¦åŒºåŸŸæ¥ç®¡ç†æ–‡ä»¶ï¼š',
            orderedList: [
              'å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰ï¼šä½ å®é™…ç¼–è¾‘æ–‡ä»¶çš„åœ°æ–¹',
              'æš‚å­˜åŒºï¼ˆStaging Areaï¼‰ï¼šå‡†å¤‡æäº¤çš„æ–‡ä»¶é›†åˆ',
              'æœ¬åœ°ä»“åº“ï¼ˆLocal Repositoryï¼‰ï¼šGitä¿å­˜é¡¹ç›®å†å²çš„åœ°æ–¹'
            ]
          }
        ]
      }
    ]
  }
};

// Get content for current day (with fallback)
const content = dayContent[dayNumber] || {
  title: `Day ${dayNumber} - è¯¾ç¨‹å†…å®¹`,
  description: 'è¯¾ç¨‹å†…å®¹æ­£åœ¨å‡†å¤‡ä¸­...',
  objectives: ['è¯¾ç¨‹ç›®æ ‡å³å°†å‘å¸ƒ'],
  overview: 'æœ¬è¯¾ç¨‹å†…å®¹æ­£åœ¨ç´§å¼ å‡†å¤‡ä¸­ï¼Œè¯·ç¨åæŸ¥çœ‹ã€‚',
  sections: []
};

const title = `Day ${dayNumber} - ${content.title}`;
---

<BaseLayout title={title} description={content.description} currentDay={dayNumber}>
  <article class="day-content">
    <header class="content-header">
      <h1>{title}</h1>
      <p class="content-description">{content.description}</p>
      
      <div class="learning-objectives">
        <h2>å­¦ä¹ ç›®æ ‡</h2>
        <ul>
          {content.objectives.map(objective => (
            <li>{objective}</li>
          ))}
        </ul>
      </div>
    </header>

    <section id="overview" class="content-section">
      <h2>ä»Šæ—¥æ¦‚è§ˆ</h2>
      <p>{content.overview}</p>
    </section>

    {content.sections.map((section, sectionIndex) => (
      <section id={`section-${sectionIndex}`} class="content-section">
        <h2>{section.title}</h2>
        {section.subsections?.map((subsection, subIndex) => (
          <div key={`${sectionIndex}-${subIndex}`}>
            <h3>{subsection.title}</h3>
            <p>{subsection.content}</p>
            {subsection.list && (
              <ul>
                {subsection.list.map(item => <li>{item}</li>)}
              </ul>
            )}
            {subsection.orderedList && (
              <ol>
                {subsection.orderedList.map(item => (
                  <li><strong>{item.split('ï¼š')[0]}ï¼š</strong>{item.split('ï¼š')[1]}</li>
                ))}
              </ol>
            )}
          </div>
        ))}
      </section>
    ))}

    <div class="next-steps">
      <h2>ä¸‹ä¸€æ­¥</h2>
      <p>å®Œæˆä»Šå¤©çš„å­¦ä¹ åï¼Œè¯·å‰å¾€ï¼š</p>
      <div class="nav-cards">
        <a href={`/day-${dayNumber}/code`} class="nav-card">
          <span class="nav-card-icon">ğŸ’»</span>
          <h3>æŸ¥çœ‹ä»£ç ç¤ºä¾‹</h3>
          <p>å­¦ä¹ å®é™…ä»£ç çš„ä½¿ç”¨</p>
        </a>
        <a href={`/day-${dayNumber}/exercise`} class="nav-card">
          <span class="nav-card-icon">âœï¸</span>
          <h3>å®Œæˆç»ƒä¹ </h3>
          <p>åŠ¨æ‰‹å®è·µä»Šå¤©å­¦åˆ°çš„çŸ¥è¯†</p>
        </a>
      </div>
    </div>
  </article>
</BaseLayout>

<style>
  .day-content {
    max-width: 800px;
    margin: 0 auto;
  }

  .content-header {
    margin-bottom: 3rem;
  }

  .content-header h1 {
    font-size: 2.5rem;
    color: var(--color-text);
    margin-bottom: 1rem;
  }

  .content-description {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
    margin-bottom: 2rem;
  }

  .learning-objectives {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
  }

  .learning-objectives h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: var(--color-primary);
  }

  .learning-objectives ul {
    list-style: none;
    padding: 0;
  }

  .learning-objectives li {
    padding-left: 1.5rem;
    margin-bottom: 0.5rem;
    position: relative;
  }

  .learning-objectives li::before {
    content: "âœ“";
    position: absolute;
    left: 0;
    color: var(--color-primary);
    font-weight: bold;
  }

  .content-section {
    margin-bottom: 3rem;
  }

  .content-section h2 {
    font-size: 1.75rem;
    margin-bottom: 1rem;
    color: var(--color-text);
  }

  .content-section h3 {
    font-size: 1.25rem;
    margin: 1.5rem 0 0.75rem;
    color: var(--color-text);
  }

  .content-section p {
    line-height: 1.7;
    color: var(--color-text-secondary);
    margin-bottom: 1rem;
  }

  .content-section ul,
  .content-section ol {
    margin: 1rem 0;
    padding-left: 2rem;
    color: var(--color-text-secondary);
  }

  .content-section li {
    margin-bottom: 0.5rem;
    line-height: 1.7;
  }

  .next-steps {
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }

  .next-steps h2 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }

  .nav-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .nav-card {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    text-decoration: none;
    transition: all 0.3s;
  }

  .nav-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--color-primary);
  }

  .nav-card-icon {
    font-size: 2rem;
    display: block;
    margin-bottom: 0.75rem;
  }

  .nav-card h3 {
    font-size: 1.125rem;
    color: var(--color-text);
    margin-bottom: 0.5rem;
  }

  .nav-card p {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }
</style>